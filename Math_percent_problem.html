<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Market Challenge ‚Äî ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÅ‡∏ü‡∏£‡πå (‡∏õ.5‚Äì6) ‚Ä¢ Percent & Profit (3 ‡∏ä‡πâ‡∏≠‡∏¢‡∏™‡πå / ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤)</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#eafcf4; --bg2:#fffbe7; --ink:#0b1222; --muted:#0f766e;
    --wire:rgba(6,95,70,.2); --accent:#34d399; --accent2:#fde047; --danger:#ef4444; --ok:#16a34a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;color:var(--ink);font-family:"Kanit","Noto Sans Thai",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:radial-gradient(1200px 720px at 50% -10%, #dcfce7 0%, var(--bg1) 50%, var(--bg2) 100%)}
  .wrap{max-width:1100px;margin:auto;padding:20px 14px 96px}
  header{display:grid;justify-items:center;text-align:center;gap:8px;margin-bottom:16px}
  .brand{font-weight:900;letter-spacing:.02em;font-size:clamp(22px,4.6vw,42px);
    background:linear-gradient(90deg,#10b981,#ef4444,#f59e0b,#10b981);-webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 8px 24px rgba(0,0,0,.08)}
  .subtitle{color:var(--muted);font-size:clamp(14px,3.4vw,18px)}

  .hud{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;border:1.5px solid var(--wire);
    background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.7));border-radius:16px;box-shadow:0 16px 48px rgba(0,0,0,.08);
    padding:12px 14px;margin-bottom:14px}
  .badge{padding:8px 12px;border:1.5px solid var(--wire);border-radius:10px;background:rgba(255,255,255,.8);color:#065f46;font-weight:800;font-size:clamp(12px,3.2vw,16px)}
  .score{font-weight:900;font-size:clamp(18px,5vw,24px);color:#a16207}
  .combo{font-weight:900;color:#065f46}
  .meter{display:none;grid-column:1/-1;margin-top:6px;height:12px;border-radius:999px;background:rgba(6,95,70,.12);overflow:hidden;border:1px solid rgba(6,95,70,.2)}
  .meter>div{height:100%;width:100%;background:linear-gradient(90deg,#34d399,#fde047);transform-origin:left center}

  .card{border:1.5px solid var(--wire);border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.88));
        padding:18px;box-shadow:0 16px 48px rgba(0,0,0,.08)}

  .row{display:flex;flex-wrap:wrap;gap:12px}
  .col{flex:1 1 260px}
  label{color:#065f46;font-weight:800}
  input,select{width:100%;padding:12px;border-radius:14px;border:2px solid rgba(6,95,70,.2);background:#fff;color:#0b1222}
  .btn{display:inline-block;border:none;cursor:pointer;padding:12px 18px;border-radius:14px;font-weight:900;font-size:18px;color:#064e3b;
       background:linear-gradient(145deg,#a7f3d0,#fde68a);box-shadow:0 8px 0 #d9f99d,0 18px 30px rgba(0,0,0,.08);transition:transform .06s,filter .2s}
  .btn:active{transform:translateY(2px)}
  .btn.ghost{background:transparent;color:#065f46;border:2px solid rgba(6,95,70,.25);box-shadow:none}

  .title{display:flex;gap:10px;align-items:center;font-weight:800;font-size:clamp(18px,4.2vw,22px)}
  .stem{margin-top:12px;padding:16px;border-radius:14px;background:rgba(16,27,64,.06);border:1px dashed var(--wire);font-size:clamp(18px,4.8vw,24px);line-height:1.6}

  .choices{display:grid;gap:12px;margin-top:16px}
  .choice{position:relative;border:2px solid rgba(6,95,70,.15);background:linear-gradient(145deg, rgba(167,243,208,.25), rgba(254,240,138,.3));
          color:#062e1f;padding:14px 16px;border-radius:14px;cursor:pointer;font-weight:900;font-size:clamp(18px,5vw,26px);
          box-shadow:0 8px 20px rgba(0,0,0,.08);transition:transform .06s,filter .2s, box-shadow .2s}
  .choice:hover{transform:translateY(-1px);box-shadow:0 12px 26px rgba(0,0,0,.12)}
  .choice b.badge{position:absolute;left:10px;top:10px;border-color:transparent;background:linear-gradient(90deg,#34d399,#fde047);
                  color:#0b1120;box-shadow:inset 0 0 0 2px rgba(255,255,255,.35)}
  .choice.correct{outline:3px solid var(--ok);box-shadow:0 0 24px rgba(22,163,74,.3)}
  .choice.wrong{outline:3px solid var(--danger);box-shadow:0 0 22px rgba(239,68,68,.25)}

  .toolbox{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .tool{border:1.5px solid var(--wire);background:#fff;color:#065f46;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:800;font-size:clamp(14px,4vw,18px)}
  .tool.used{opacity:.6}
  .panel{margin-top:10px;display:none}
  .panel.show{display:block;animation:fade .22s ease}
  .panel .hint{border:1.5px solid var(--wire);border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.9);color:#065f46;font-size:clamp(16px,4vw,20px)}

  .status{margin-top:12px;font-weight:800;font-size:clamp(16px,4.2vw,20px)}
  .oktxt{color:#15803d}.badtxt{color:#b91c1c}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
  .next{border:1.5px solid var(--wire);background:linear-gradient(90deg,rgba(167,243,208,.5),rgba(254,240,138,.55));color:#064e3b;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:900;font-size:clamp(16px,4.2vw,20px)}

  .endcard{display:none;margin-top:18px;padding:20px;border-radius:16px;border:1.5px solid var(--wire);
           background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.9));text-align:center}
  .endcard.show{display:block;animation:pop .25s ease}
  .endcard h2{margin:6px 0 0;font-size:clamp(22px,5vw,28px)}
  .rank{font-size:clamp(16px,4vw,20px);font-weight:900;margin-top:6px}
  canvas.fire{position:fixed;inset:0;pointer-events:none}

  @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  @keyframes pop{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
  @media (max-width:600px){.wrap{padding:16px 12px 84px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">Math Market Challenge üõçÔ∏è ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÅ‡∏ü‡∏£‡πå</div>
    <div class="subtitle">‡∏™‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Ä¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ‚Ä¢ ‡∏°‡∏µ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‚Ä¢ ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü‡∏ï‡∏≠‡∏ô‡∏à‡∏ö</div>
  </header>

  <!-- HUD -->
  <div class="hud">
    <div class="badge">‡∏°‡∏¥‡πâ‡∏ô‡∏ï‡πå‚Äì‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á | Percent ‚Ä¢ Profit ‚Ä¢ Discount</div>
    <div class="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="total">0</span></div>
    <div class="combo">COMBO: <span id="combo">x1.0</span></div>
    <div class="meter"><div id="timebar"></div></div>
  </div>

  <!-- HOME -->
  <section id="home" class="card home">
    <h1 style="margin:0 0 8px">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÅ‡∏ü‡∏£‡πå!</h1>
    <div class="row" style="margin-top:8px">
      <div class="col"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label><input id="playerName" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." /></div>
      <div class="col"><label>‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label>
        <select id="voiceSel">
          <option value="both" selected>‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Ñ‡∏£‡∏ö</option>
          <option value="beep">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏µ‡πä‡∏ö</option>
          <option value="mute">‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
        </select>
      </div>
    </div>
    <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô üéÆ</button>
      <button class="btn ghost" id="howBtn">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏£‡πá‡∏ß ‚ùì</button>
    </div>
  </section>

  <!-- HOWTO -->
  <section id="howto" class="card" style="display:none">
    <div class="title">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î(‡πÑ‡∏°‡πà)‡∏•‡∏±‡∏ö‡∏Ñ‡∏¥‡∏î‡πÄ‡∏£‡πá‡∏ß</div>
    <ul style="margin:8px 0 0 18px; line-height:1.7">
      <li>‡∏Å‡∏≥‡πÑ‡∏£ <b>x%</b> ‚áí ‡∏Ç‡∏≤‡∏¢ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô √ó (1 + x/100)</li>
      <li>‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ <b>x%</b> ‚áí ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ = ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤ √ó (1 ‚àí x/100)</li>
      <li>‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‚áí <b>‡∏Å‡∏≥‡πÑ‡∏£/‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô √ó 100</b> = ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</li>
      <li>‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏™‡∏ß‡∏¢‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î: 10%, 20%, 25%, 50% ‡∏Ñ‡∏¥‡∏î‡πÉ‡∏ô‡πÉ‡∏à‡πÑ‡∏ß‡∏°‡∏≤‡∏Å!</li>
    </ul>
    <div class="footer"><button class="next" id="backHome">‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </section>

  <!-- QUIZ CARD -->
  <section id="quiz" class="card" style="display:none">
    <div class="title"><span class="badge" id="caseId">Q-01</span> <span id="caseTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span></div>
    <div class="stem" id="stem">‚Äî</div>
    <div class="choices" id="choices"></div>

    <div class="toolbox">
      <button class="tool" id="hintBtn">üß≠ Hint (‡πÉ‡∏ö‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î)</button>
      <button class="tool" id="solBtn" disabled>üìù ‡πÄ‡∏â‡∏•‡∏¢ (‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≠‡∏ö)</button>
    </div>
    <div class="panel" id="hintPanel"><div class="hint" id="hintText">‚Äî</div></div>

    <div class="status" id="status"></div>
    <div class="footer">
      <button class="next" id="nextBtn" disabled>‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚Üí</button>
      <div class="badge">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ (‡∏ê‡∏≤‡∏ô 5): <span id="slot">5</span></div>
    </div>
  </section>

  <!-- END -->
  <section id="end" class="endcard">
    <div class="badge">MATH MARKET ACADEMY</div>
    <h2 id="endTitle">Mission Complete!</h2>
    <p id="endMsg">‚Äî</p>
    <div style="display:flex;justify-content:center;gap:10px">
      <button class="next" onclick="location.reload()">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
    </div>
  </section>
</div>
<canvas id="fire1" class="fire"></canvas>
<canvas id="fire2" class="fire"></canvas>

<script>
/* =============== DATA: 20 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå 3 ‡∏ä‡πâ‡∏≠‡∏¢‡∏™‡πå =============== */
const ITEMS=[
 {id:'001', stem:'‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡πâ‡∏°‡∏°‡∏≤ 405 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡πÑ‡∏£ 20% ‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['486 ‡∏ö‡∏≤‡∏ó','485 ‡∏ö‡∏≤‡∏ó','492 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'‡∏Ç‡∏≤‡∏¢ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô √ó 1.20', why:'405 √ó 1.2 = 486 ‡∏ö‡∏≤‡∏ó'},
 {id:'002', stem:'‡∏õ‡∏•‡∏≤‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏û‡πá‡∏Ñ‡∏•‡∏∞ 36 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡πÑ‡∏£ 25% ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['45 ‡∏ö‡∏≤‡∏ó','42 ‡∏ö‡∏≤‡∏ó','44 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 1.25', why:'36 √ó 1.25 = 45'},
 {id:'003', stem:'‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á 4,000 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡πÑ‡∏£ 1,000 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['25%','40%','20%'], key:0, hint:'‡∏Å‡∏≥‡πÑ‡∏£/‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô √ó 100', why:'1,000 √∑ 4,000 = 0.25 = 25%'},
 {id:'004', stem:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏Å‡∏¥‡πÇ‡∏•‡∏•‡∏∞ 140 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î 15% ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['119 ‡∏ö‡∏≤‡∏ó','125 ‡∏ö‡∏≤‡∏ó','120 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.85', why:'140 √ó 0.85 = 119'},
 {id:'005', stem:'‡∏ï‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ 120 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î‡πÉ‡∏´‡πâ 15 ‡∏ö‡∏≤‡∏ó ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏µ‡πà‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå?', opts:['12.5%','15%','10%'], key:0, hint:'‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î/‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤ √ó100', why:'15/120 = 12.5%'},
 {id:'006', stem:'‡∏ó‡∏∏‡∏ô 250 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡πÑ‡∏£ 10% ‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['275 ‡∏ö‡∏≤‡∏ó','260 ‡∏ö‡∏≤‡∏ó','265 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 1.10', why:'250 √ó 1.10 = 275'},
 {id:'007', stem:'‡∏ó‡∏∏‡∏ô 21,000 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£ 35% ‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['7,350 ‡∏ö‡∏≤‡∏ó','3,500 ‡∏ö‡∏≤‡∏ó','6,300 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'‡∏Å‡∏≥‡πÑ‡∏£ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô √ó 0.35', why:'21,000 √ó 0.35 = 7,350'},
 {id:'008', stem:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 350 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 12% ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['308 ‡∏ö‡∏≤‡∏ó','320 ‡∏ö‡∏≤‡∏ó','300 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó (1 ‚àí 0.12)', why:'350 √ó 0.88 = 308'},
 {id:'009', stem:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 18 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢ 24 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['33‚Öì%','25%','20%'], key:0, hint:'‡∏Å‡∏≥‡πÑ‡∏£ 6 ‡∏ö‡∏≤‡∏ó √∑ 18', why:'6/18 = 1/3 = 33.33%'},
 {id:'010', stem:'‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ 20% ‡∏à‡∏≤‡∏Å 60 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['48 ‡∏ö‡∏≤‡∏ó','50 ‡∏ö‡∏≤‡∏ó','46 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'60 √ó 0.80', why:'= 48 ‡∏ö‡∏≤‡∏ó'},
 {id:'011', stem:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 2,450 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ 40% ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['1,470 ‡∏ö‡∏≤‡∏ó','1,000 ‡∏ö‡∏≤‡∏ó','1,540 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.60', why:'2,450 √ó 0.60 = 1,470'},
 {id:'012', stem:'‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏Ç‡∏ß‡∏î‡∏•‡∏∞ 60 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏Ç‡∏ß‡∏î‡∏•‡∏∞ 3 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏Å‡∏µ‡πà‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢?', opts:['5%','3%','4%'], key:0, hint:'‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô/‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ √ó100', why:'3/60 = 5%'},
 {id:'013', stem:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 3,220 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ 10% ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['2,898 ‡∏ö‡∏≤‡∏ó','2,884 ‡∏ö‡∏≤‡∏ó','2,980 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.90', why:'3,220 √ó 0.90 = 2,898'},
 {id:'014', stem:'‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ 200 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î 25% ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['150 ‡∏ö‡∏≤‡∏ó','175 ‡∏ö‡∏≤‡∏ó','125 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.75', why:'200 √ó 0.75 = 150'},
 {id:'015', stem:'‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏Å‡πÑ‡∏î‡πâ 360 ‡∏ö‡∏≤‡∏ó ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô 300 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['20%','25%','16‚Öî%'], key:0, hint:'‡∏Å‡∏≥‡πÑ‡∏£ 60 √∑ 300', why:'60/300 = 0.2 = 20%'},
 {id:'016', stem:'‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡∏î‡∏à‡∏≤‡∏Å 175 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 147 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î‡∏Å‡∏µ‡πà‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå?', opts:['16%','28%','14%'], key:0, hint:'‡∏•‡∏î‡πÑ‡∏õ 28 ‡∏à‡∏≤‡∏Å 175', why:'28/175 = 0.16 = 16%'},
 {id:'017', stem:'‡∏ó‡∏∏‡∏ô 825 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡πÑ‡∏£ 16% ‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['957 ‡∏ö‡∏≤‡∏ó','132 ‡∏ö‡∏≤‡∏ó','960 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 1.16', why:'825 √ó 1.16 = 957'},
 {id:'018', stem:'‡∏™‡∏°‡∏∏‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏•‡πà‡∏°‡∏•‡∏∞ 28 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢ 35 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['25%','20%','30%'], key:0, hint:'‡∏Å‡∏≥‡πÑ‡∏£ 7 √∑ 28', why:'= 25%'},
 {id:'019', stem:'‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ 5% ‡∏à‡∏≤‡∏Å‡∏õ‡πâ‡∏≤‡∏¢ 1,860 ‡∏ö‡∏≤‡∏ó ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['1,767 ‡∏ö‡∏≤‡∏ó','1,768 ‡∏ö‡∏≤‡∏ó','1,760 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.95', why:'1,860 √ó 0.95 = 1,767'},
 {id:'020', stem:'‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏´‡∏ô‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤ 380 ‡∏ö‡∏≤‡∏ó ‡∏•‡∏î 5% ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?', opts:['361 ‡∏ö‡∏≤‡∏ó','362 ‡∏ö‡∏≤‡∏ó','360 ‡∏ö‡∏≤‡∏ó'], key:0, hint:'√ó 0.95', why:'380 √ó 0.95 = 361'}
];

/* ===================== UTIL ===================== */
const $=id=>document.getElementById(id);
function shuffle(a){ a=a.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function show(el){ el.style.display='block'; }
function hide(el){ el.style.display='none'; }

/* ===================== STATE & ELEMENTS ===================== */
let idx=0,total=0,slot=5,answered=false,combo=1.0;
const elTotal=$("total"), elCombo=$("combo"), elTimebar=$("timebar");
const secHome=$("home"), secHow=$("howto"), secQuiz=$("quiz"), secEnd=$("end");
const elCaseId=$("caseId"), elStem=$("stem"), elChoices=$("choices");
const elStatus=$("status"), elNext=$("nextBtn"), elSlot=$("slot"), elHintBtn=$("hintBtn"), elHintPanel=$("hintPanel"), elHintText=$("hintText"), elSolBtn=$("solBtn");

/* ===================== AUDIO (‡πÄ‡∏ö‡∏≤ ‡πÜ) ===================== */
let audioCtx=null; function ensureAudio(){ if(!audioCtx){ audioCtx=new (window.AudioContext||window.webkitAudioContext)(); } }
function beep(f=880,d=.08,type='triangle',vol=.12){ if($("voiceSel").value==='mute') return; try{ ensureAudio(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type=type; o.frequency.value=f; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); setTimeout(()=>o.stop(), d*1000);}catch(e){} }
function okSFX(){ if($("voiceSel").value==='mute') return; beep(920,.07,'triangle',.14); setTimeout(()=>beep(1140,.07,'triangle',.13),110); setTimeout(()=>beep(1370,.09,'triangle',.12),220); }
function badSFX(){ if($("voiceSel").value==='mute') return; ensureAudio(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(300,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(110,audioCtx.currentTime+.35); g.gain.value=.14; o.connect(g); g.connect(audioCtx.destination); o.start(); setTimeout(()=>o.stop(), 380); }

/* ===================== FIREWORKS ===================== */
function fireworks(canvas){ const ctx=canvas.getContext('2d'); canvas.width=innerWidth; canvas.height=innerHeight; const parts=[]; for(let k=0;k<7;k++){ const cx=Math.random()*canvas.width, cy=Math.random()*canvas.height*.5+canvas.height*.1, col=`hsl(${Math.random()*360},90%,60%)`; for(let i=0;i<60;i++){ const a=Math.random()*Math.PI*2, sp=Math.random()*3+1; parts.push({x:cx,y:cy,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:Math.random()*60+50,color:col}); } } let t=0; (function loop(){ t++; ctx.fillStyle="rgba(0,0,0,.06)"; ctx.fillRect(0,0,canvas.width,canvas.height); parts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=.02; p.life--; ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,2,2);}); if(t<140) requestAnimationFrame(loop); })(); }

/* ===================== RENDER ===================== */
const ORDER = ITEMS.slice();
function render(){
  answered=false; slot=5; elSlot.textContent=slot; elStatus.textContent=''; elNext.disabled=true; elSolBtn.disabled=true;
  elHintPanel.classList.remove('show'); elHintBtn.disabled=false; elHintBtn.classList.remove('used');
  const it=ORDER[idx]; elCaseId.textContent=`Q-${it.id}`; elStem.textContent=it.stem; elChoices.innerHTML='';
  it.opts.forEach((op,i)=>{ const btn=document.createElement('button'); btn.className='choice'; btn.innerHTML=`<b class="badge">${String.fromCharCode(65+i)}</b> ${op}`; btn.addEventListener('click',()=>answer(i,btn)); elChoices.appendChild(btn); });
}

function useHint(){ if(answered || elHintBtn.disabled) return; const it=ORDER[idx]; elHintText.textContent=it.hint; elHintPanel.classList.add('show'); elHintBtn.classList.add('used'); elHintBtn.disabled=true; slot=Math.max(3, slot-2); elSlot.textContent=slot; }
function showSol(){ const it=ORDER[idx]; elStatus.innerHTML += `<br><small>‡πÄ‡∏â‡∏•‡∏¢‡πÄ‡∏ï‡πá‡∏°: ${it.why}</small>`; }

function answer(i,btn){ if(answered) return; answered=true; const it=ORDER[idx]; const nodes=[...document.querySelectorAll('.choice')]; nodes.forEach(n=>n.disabled=true);
  if(i===it.key){ okSFX(); btn.classList.add('correct'); combo = Math.min(1.5, +(combo+0.1).toFixed(1)); const gained = Math.round(slot * combo); elStatus.innerHTML=`‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! <span class="oktxt">+${gained}</span> (‡∏ê‡∏≤‡∏ô ${slot}, ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö x${combo.toFixed(1)})`; total += gained; }
  else { badSFX(); if(elChoices.children[it.key]) elChoices.children[it.key].classList.add('correct'); nodes.forEach(n=>{ if(!n.classList.contains('correct')) n.classList.add('wrong');}); combo=1.0; elStatus.innerHTML=`‚ùå ‡∏ú‡∏¥‡∏î ‚Ä¢ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠ <b>${it.opts[it.key]}</b>`; }
  elTotal.textContent=total; elCombo.textContent=`x${combo.toFixed(1)}`; elNext.disabled=false; elSolBtn.disabled=false;
}

function nextQuestion(){ idx++; if(idx<ORDER.length) render(); else finish(); }

/* ===================== END ===================== */
function finish(){ hide(secQuiz); show(secEnd); const t=$("endTitle"), m=$("endMsg"); let rank,note; if(total>=80){rank='üèÜ Market Master';note='‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ß ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏°‡∏≤‡∏Å!';} else if(total>=60){rank='üéñÔ∏è Smart Seller';note='‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏£‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô';} else {rank='üî∞ Rookie Cashier';note='‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö';} t.textContent='Mission Complete ‚Äî Math Market'; m.innerHTML=`<b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${total} / ${ORDER.length*10}</b><br><span class="rank">${rank}</span><br>${note}`; fireworks($("fire1")); setTimeout(()=>fireworks($("fire2")),260); }

/* ===================== BUTTONS & FLOW ===================== */
$("startBtn").addEventListener('click', ()=>{ total=0; idx=0; combo=1.0; elTotal.textContent=0; elCombo.textContent='x1.0'; hide(secHome); show(secQuiz); render(); });
$("howBtn").addEventListener('click', ()=>{ hide(secHome); show(secHow); });
$("backHome").addEventListener('click', ()=>{ hide(secHow); show(secHome); });
$("nextBtn").addEventListener('click', nextQuestion);
$("hintBtn").addEventListener('click', useHint);
$("solBtn").addEventListener('click', showSol);
</script>
</body>
</html>